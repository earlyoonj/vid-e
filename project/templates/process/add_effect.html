{% extends 'base.html' %}

{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/add_effect.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css">
{% endblock %}


<!-- header : video -->
{% block video %}
    <video id="input-video" src="{{ url_for('static', filename=video.src) }}" width = "280" height = "160" controls></video>
{% endblock %}
<!-- header : control -->
{% block control %}
    <button type="button" id="export">export</button>
{% endblock %}


{% block content %}

    <ol id="sentence-list">
        {% for sentence in keyword_sentences %}
            <li tabindex="0">
                {{sentence.text.prev}}
                <strong class="keyword">{{sentence.text.keyword}}</strong>
                {{sentence.text.next}}
            </li>
        {% endfor %}
    </ol>

    <!-- 여기 -->
    <div id="effect-list">
        <div id="select-position">
            <input type="radio" id="front" name="position" value="start" checked>
            <label for="front">앞</label>
        
            <input type="radio" id="back" name="position" value="end">
            <label for="back">뒤</label>
        </div>

        <div id = "current_audio">
            <strong id="current_audio_name">현재 오디오를 나타냅니다.</strong>
        </div>

        <div id = "remove_audio">
            <button type="button" id="remove_current">효과음삭제</button>
        </div>

        <div id="audio-list">
        {% for i, src in enumerate(effect_src) %}
            <audio id="{{i}}" src="{{ url_for('static', filename='lib/sound_effect/'+src) }}"></audio>
        {% endfor %}
        </div>
        <br>
        <div id="short-effect">
            <h4>SHORT</h4>
            <ul></ul>
        </div>
        <div id="long-effect">
            <h4>LONG</h4>
            <ul></ul>
        </div>
    </div>
{% endblock %} 

{% block js %}
    <script src="{{ url_for('static', filename='js/add-effect.js') }}"></script>
    <script>
        // export event
        const exportBtn = document.getElementById("export");
        exportBtn.addEventListener("click", () => exportResult("{{ url_for('add_effect_export', id=video.id) }}"));

        // html variable
        const sentenceList = document.querySelectorAll("#sentence-list > li");
        const effectList = JSON.parse('{{ effect_src | tojson | safe }}');
        const sentences = JSON.parse('{{ keyword_sentences | tojson | safe }}');
        const preview = document.getElementById("input-video");

        // global variable
        let time;
        let currentIdx;
        let currentEffect;
        let exportEffectList = new Array(sentences.length);
        let exportTimeList = new Array(sentences.length);
        
        //remove_audio_function
        const removeBtn = document.getElementById('remove_current');
        removeBtn.addEventListener("click",() => removeEffect(currentIdx));
        // call function;
        loadEffect('{{ effect_data|tojson }}'); // 작은 따옴표여야만 합니다
        setSentenceEvent();
    </script>
{% endblock %}